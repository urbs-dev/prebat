<script>
    export let chart
    export let values

    import Doughnut from './chartsTypes/Doughnut.svelte';
    import Bar from './chartsTypes/Bar.svelte';
    import StackedHzBar from './chartsTypes/StackedHzBar.svelte';
    import StackedBar from './chartsTypes/StackedBar.svelte';
    import ErrorBar from './chartsTypes/ErrorBar.svelte';
    import MultipleErrorBar from './chartsTypes/MultipleErrorBar.svelte';
    import GroupedBar from './chartsTypes/GroupedBar.svelte';
    import Histogram from './chartsTypes/Histogram.svelte';

    const TYPE = {
        'stacked_hzbar': StackedHzBar,
        'stacked_bar': StackedBar,
        'bar': Bar,
        'doughnut': Doughnut,
        'error_bar': ErrorBar,
        'multiple_error_bar': MultipleErrorBar,
        'grouped_bar': GroupedBar,
        'histogram': Histogram
    }

    const isArray = (value) => Array.isArray(value) && value.length > 0

    const valueIsSingle = (values, attribute) =>{
        if (isArray(attribute))  return false
        if (!values[attribute]) return false
        return true
    } 

    const getArrayValues = (attributes) => {
        let result = {}
        attributes.forEach(attribute => {
            if (!values[attribute]) return result = false
            result[attribute] = values[attribute]
        })
        return result
    }

</script>

<section class="chart">
    <h4>{chart.title}</h4> 
    <div>
        {#if values}
            {#if isArray(chart.attribute) && getArrayValues(chart.attribute)}
                {#key values}
                    <svelte:component this={TYPE[chart.type]} value={getArrayValues(chart.attribute)} options={chart}/>
                {/key}
            {:else if valueIsSingle(values ,chart.attribute)}
                <svelte:component this={TYPE[chart.type]} bind:value={values[chart.attribute]} options={chart}/>
            {:else}
                <svelte:component this={TYPE[chart.type]} bind:value={values} options={chart} row={true}/>
            {/if}
        {/if}


    </div>
</section>

<style>
    section{
        padding: 0 16px;
        border-radius: 8px;
        width: fit-content;
        height: fit-content;
        background-color: #fefefe;

    }
    h4{
        color: var(--primary-lighten);
        font-size: 18px;
        margin: 16px 0 8px 0;
    }
    div{
        display: flex;
        justify-content: center;
    }
</style>